{
  "groups": [
    "aws",
    "ubuntu-trusty"
  ],
  "task": {
    "image": {
      "source": {
        "repository": "concourse/bosh-io-stemcell-resource"
      }
    },
    "run": {
      "path": "bash",
      "args": [
        "-c",
        (
          [
            "url=\"$( cat stemcell/url | sed 's/light-//' )\"",
            "; curl -o result/stemcell.tgz \"$url\"",
            "&& tar -xOzf stemcell/stemcell.tgz stemcell.MF > /tmp/stemcell.MF",
            "&& mkdir result/.datapact",
            "&& jq -nc ",
            "--arg name \"$( grep '^name: ' < /tmp/stemcell.MF | awk '{ print $2 }' )\"",
            "--arg version \"$( cat stemcell/version )\"",
            "--arg url \"$url\"",
            "'{branch:\":concourse\",result:($name+\"/\"+$version),metadata:({name:$name,version:$version,url:$url}|to_entries)}'",
            " > result/.datapact/result"
          ]
          | join(" ")
        )
      ]
    }
  },
  "input": [
    {
      "alias": "stemcell",
      "resource": {
        "type": "bosh-io-stemcell",
        "source": {
          "name": "bosh-aws-xen-ubuntu-trusty-go_agent"
        }
      }
    }
  ]
}
